@model MHD.Models.PackagesModel
@{
    ViewBag.Title = "Packages";
    Layout = "~/Views/Shared/_Layout_Receptionist.cshtml";
}


<div id="content" class="content">

    <!-- begin panel -->

    <div class="panel panel-inverse">
        <!-- begin panel-heading -->
        <div class="panel-heading">
            <h4 class="panel-title">Packages</h4>
        </div>
        <a href="#modal-dialog" class="btn btn-lg btn-success pull-right m-15" data-toggle="modal">ADD</a>
        <!-- end panel-heading -->
        <!-- begin panel-body -->
        <div class="panel-body">
            <table id="data-table-buttons" class=" table-responsive table-hover employees-table table table-striped table-bordered">
                <thead>
                    <tr>
                        <th width="1%" type="hidden"></th>
                        <th class="text-center">Package Name</th>
                        <th class="text-center">Package Price</th>
                        <th class="text-center">Max Time</th>
                        <th class="text-center">Date Updated</th>
                        <th class="text-center">Description</th>
                        <th class="text-center"></th>
                        <th class="text-center"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var data in Model.Packages)
                    {
                    <tr class="gradeU">
                        <td class="table_id f-s-600 text-center" type="hidden">@data.rate_id</td>
                        <td class="text-center"><b>@data.package_name</b></td>
                        <td style="text-transform:uppercase" class="text-center">@data.package_price</td>
                        <td class="text-center">@data.package_maxtime</td>
                        <td class="text-center">@data.date_modified</td>
                        @if (@data.package_description.Length > 11)
                        {
                            <td class="text-center">@data.package_description.Substring(0, 10)...</td>
                        }
                        @if (@data.package_description.Length < 11)
                        {
                            <td class="text-center">@data.package_description</td>
                        }
                        <td class="text-center">
                            <a href="#edit-modal-dialog" onclick="openDialog(@data.rate_id,
            '@data.package_name','@data.package_description','@data.package_price','@data.package_maxtime')" data-toggle="edit-team-modal">
                                <button type="button" class="btn btn-success">Edit</button>
                            </a>
                        </td>
                        <td class="text-center">
                            <a onclick="Disposepackage(@data.rate_id)">
                                <button type="button" class="btn btn-danger">Dispose</button>
                            </a>
                        </td>

                    </tr>

                    }

                </tbody>
            </table>
        </div>
        <!-- end panel-body -->
    </div>

</div>


<!-- modal for add new team -->
<div class="modal fade" id="modal-dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add New Team</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="register-content">
                    <form action="" id="new-package" class="margin-bottom-0">

                        <label class="control-label">New Package Name<span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <input type="text" class="form-control" name="newpackagename" placeholder=" " required />
                            </div>
                        </div>
                        <label class="control-label">New Package Price<span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <input type="number" class="form-control" name="newpackageprice" placeholder=" " required />
                            </div>
                        </div>
                        <label class="control-label">New Package Max Time<span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <input type="number" class="form-control"  name="newpackagemaxtime" placeholder=" " required />
                            </div>
                        </div>
                        <label class="control-label">Description <span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <textarea class="form-control m-b-10"  name="newpackagedesc" rows="7"></textarea>

                            </div>
                        </div>
                        <p class="text-center invalid-feedback" style="display: none;" id="error_request">
                            Account Already Exists.
                        </p>


                        <hr />



                        <div class="modal-footer">
                            <a href="javascript:;" class="btn btn-white" data-dismiss="modal">Close</a>

                            <div class="register-buttons">
                                <button type="submit" name="add_new_team" class="btn btn-primary btn-block">Add</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end modal for add new team -->
<!-- modal for edit team -->

<div class="edit-team-modal modal fade" id="edit-modal-dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit </h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="register-content">
                    <form action="" id="edit-team" method="POST" class="margin-bottom-0">
                        <meta name="csrf-token" id="csrf-token" content="{{ csrf_token() }}">
                        <label class="control-label">New Package Name<span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <input type="text" class="form-control" id="edit_package_name" name="teamname" placeholder=" " required />
                            </div>
                        </div>
                        <label class="control-label">New Package Price<span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <input type="number" class="form-control" id="edit_package_price" name="teamname" placeholder=" " required />
                            </div>
                        </div>
                        <label class="control-label">New Package Max Time<span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <input type="number" class="form-control" id="edit_package_maxtime" name="teamname" placeholder=" " required />
                            </div>
                        </div>
                        <label class="control-label">Description <span class="text-danger">*</span></label>
                        <div class="row m-b-15">
                            <div class="col-md-12">
                                <textarea class="form-control m-b-10" id="edit_package_desc" name="teamdesc" rows="7"></textarea>

                            </div>
                        </div>
                        <input type="hidden" name="_token" id="token" value="{{ csrf_token() }}">
                        <p class="text-center invalid-feedback" style="display: none;" id="edit_team_error_request">
                            Account Already Exists.
                        </p>


                        <hr />


                        <div class="modal-footer">
                            <a href="javascript:;" class="btn btn-white" data-dismiss="modal">Close</a>
                            <div class="register-buttons">
                                <button type="submit" name="edit-team" class="btn btn-primary btn-block">Update</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end modal for edit team -->
<script src="~/wwwroot/assets/plugins/jquery/jquery-3.2.1.min.js"></script>
<script src="~/wwwroot/assets/plugins/jquery-ui/jquery-ui.min.js"></script>

<script src="~/wwwroot/assets/plugins/DataTables/media/js/jquery.dataTables.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/media/js/dataTables.bootstrap.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/dataTables.buttons.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/buttons.bootstrap.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/buttons.flash.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/jszip.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/pdfmake.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/vfs_fonts.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/buttons.html5.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Buttons/js/buttons.print.min.js"></script>
<script src="~/wwwroot/assets/plugins/DataTables/extensions/Responsive/js/dataTables.responsive.min.js"></script>
<script src="~/wwwroot/assets/js/demo/table-manage-buttons.demo.min.js"></script>
<script src="~/wwwroot/assets/js/demo/ui-modal-notification.demo.min.js"></script>
<script src="~/wwwroot/assets/plugins/gritter/js/jquery.gritter.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        TableManageButtons.init();
    });
</script>
<script type="text/javascript">

         $(function () {

    $('#new-package').on('submit', function (e) {
        e.preventDefault();
        var teamid = (document.URL).substring(document.URL.lastIndexOf('=') + 1);
        var formData = {
    'packagename'        : $('input[name=newpackagename]').val(),
    'packagedesc'        : $('textarea[name=newpackagedesc]').val(),
    'packageprice'       : $('input[name=newpackageprice]').val(),
    'packagemaxtime'     : $('input[name=newpackagemaxtime]').val(),
    'teamid'             : teamid,
    '_token': "{{ csrf_token() }}"
    };
    $.ajax({
    type: 'post',
    url: '/Receptionist/NewPackage',
    data: formData,
    success: function (response) {
    var obj = JSON.parse(response);
    console.log(obj);
        if (obj.RESULT == "ERROR") {
            if (obj.ERROR_CODE == 2627) {
                var x = document.getElementById("error_request");
                x.innerHTML = "error";
                x.style.display = "block";
            }
        }
        else location.reload(true);
    }
    });

    });
});
</script>

<script type="text/javascript">
    function Disposepackage(packageid) {
        var formData = {
            'packageid': packageid
        };

        $.ajax({
            type: 'post',
            url: '/Receptionist/DisposePackage',
            data: formData,
            success: function (response) {

                console.log(obj);
                var obj = JSON.parse(response);
                if (obj.RESULT == "ERROR") {
                    if (obj.ERROR_CODE == 2627) {
                        var x = document.getElementById("edit_dasher_error_request");
                        x.innerHTML = "Phone Number is Already Used";
                        x.style.display = "block";
                    }
                }
                else location.reload(true);
            }
        });

    }
        function openDialog(id, name, desc, price, maxtime) {
            $('#edit_package_name').val(name);
            $('#edit_package_desc').val(desc);
            $('#edit_package_price').val(price);
            $('#edit_package_maxtime').val(maxtime);
            $('#edit-modal-dialog').modal('show');
            $rateid = id;
         $("#edit-team").on("submit",function(e){
    e.preventDefault();
    var formData = {
        'packageid': $rateid,
        'new_package_name': $('input[id=edit_package_name]').val(),
        'new_package_price': $('input[id=edit_package_price]').val(),
        'new_package_description': $('textarea[id=edit_package_desc]').val(),
        'new_max_time': $('input[id=edit_package_maxtime]').val(),
        '_token': "{{ csrf_token() }}"
    };

    $.ajax({
    type: 'post',
    url: '/Receptionist/UpdatePackage',
    data: formData,
    success: function (response) {

    console.log(obj);
    var obj = JSON.parse(response);
        if (obj.RESULT == "ERROR") {
            if (obj.ERROR_CODE == 2627) {
                var x = document.getElementById("edit_dasher_error_request");
                x.innerHTML = "Phone Number is Already Used";
                x.style.display = "block";
            }
        }
        else location.reload(true);
    }
    });

});
     }

</script>



